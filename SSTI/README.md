# Server-Side Template Injection (Инъекция шаблонов на стороне сервера)

## Концепция

Уязвимости SSTI (Server-Side Template Injection) возникают, когда пользовательский ввод внедряется в серверные шаблоны без должной проверки или санитизации. Это позволяет злоумышленникам внедрять вредоносный код в шаблоны, что может привести к удаленному выполнению кода (RCE) или краже данных. Такие уязвимости часто встречаются в веб-приложениях, использующих шаблонизаторы вроде Jinja2, Twig или Freemarker для генерации динамического контента. Например, если веб-страница динамически отображает пользовательский текст с помощью шаблонизатора, это может привести к непреднамеренному выполнению вредоносных выражений.

## Принцип атаки

Когда приложение напрямую встраивает пользовательский ввод в серверный шаблонизатор, злоумышленники могут внедрить вредоносный код, манипулируя входными данными. Они используют возможность шаблонизатора интерпретировать плейсхолдеры и выражения, которые могут включать логику (условия, циклы, вызовы функций). Если шаблонизатор неправильно настроен или не имеет ограничений, он становится вектором для выполнения произвольного кода.

## Пример атаки

Рассмотрим веб-приложение на Python с шаблонизатором Jinja2, которое отображает пользовательский контент. Допустим, страница приветствует пользователя, используя переданное имя:

```python
from flask import Flask, render_template_string, request
app = Flask(__name__)
@app.route('/greet')
def greet():
    user_input = request.args.get('name')
    template = f"Hello, {{ {user_input} }}!"
    return render_template_string(template)
```

Злоумышленник может передать в параметр `name` значение `{{ 7 * 7 }}`. Если приложение вернет `49`, это подтвердит выполнение кода шаблонизатором. Затем атака может быть усилена внедрением опасных payload-ов, например `{{ __import__('os').system('ls') }}`, для выполнения команд на сервере (в данном случае — просмотра файлов).
