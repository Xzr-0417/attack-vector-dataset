# LDAP-инъекции

## Концепция

Уязвимости, связанные с LDAP-инъекциями (Lightweight Directory Access Protocol), позволяют злоумышленникам нарушать процесс аутентификации на некоторых веб-сайтах. Эта уязвимость возникает, когда сайты используют данные, предоставленные конечными пользователями, для построения LDAP-запросов. LDAP-каталоги хранят учетные данные доступа в виде объектов. Информация может использоваться различными сущностями: пользователями, ролями, принтерами, серверами. Когда LDAP-каталоги применяются для аутентификации на сайте, злоумышленники могут внедрять вредоносный код через пользовательские поля ввода. Это позволяет получить несанкционированный доступ к LDAP-каталогу, где злоумышленник может просматривать или изменять логины и пароли.

## Принцип атаки

При LDAP-инъекциях злоумышленник манипулирует входными данными запросов для получения несанкционированного доступа к каталогу. Так как этот каталог может содержать почтовые адреса, логины и пароли организации или пользователей, такое вторжение может иметь катастрофические последствия. Злоумышленники ищут уязвимости в решениях, использующих LDAP-сервисы. Воспользовавшись недостаточной фильтрацией входных данных, они отправляют необработанные пользовательские данные (например, LDAP-запросы для взлома системы) и пытаются проникнуть в приложение. В случае успеха злоумышленник может изменять, удалять, использовать в злонамеренных целях или добавлять учетные данные в зависимости от своих намерений.

## Пример атаки

Базовый пример LDAP-инъекции — обход аутентификации злоумышленником. Предположим, фильтр поиска LDAP принимает два поля через веб-форму — USER и PASSWORD. Если параметр USER принимается без санитизации управляющих символов, злоумышленник может ввести логин с символами, нарушающими аутентификацию. Например, если злоумышленник укажет значение USER как `admin)(|(memberOf=*)`, LDAP-запрос сформируется так: изначальный запрос `(&(USER=admin)(PASSWORD=Pwd))` превратится в `(&(USER=admin)(|(memberOf=*))(PASSWORD=Pwd))`. Это заставляет LDAP-сервер обработать только первую часть запроса (выделено жирным). Пароль вообще не проверяется, что позволяет злоумышленнику ввести любую строку в качестве пароля и получить доступ.
